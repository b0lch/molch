<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>MolchOS</title>
  <style>
    body {
      background-color: #000;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      color: white;
      text-align: center;
    }

    h1 {
      font-size: 80px;
      margin-top: 40px;
    }

    /* Fortschrittsbalken */
    #myProgress {
      width: 40%;
      background-color: #333;
      margin: 30px auto 0;
      border-radius: 25px;
      height: 30px;
      overflow: hidden;
      display: none;
    }

    #myBar {
      height: 30px;
      background-color: #fff;
      border-radius: 25px;
      width: 0%;
      transition: width 0.3s ease;
    }

    /* Startbutton */
    #startButton {
      background: transparent;
      border: none;
      cursor: pointer;
      display: block;
      margin: 30px auto;
      padding: 0;
      width: 100px;
      height: 100px;
    }

    #startButton img {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* Login-Formular */
    #loginForm {
      display: none;
      margin-top: 50px;
      width: 300px;
      margin-left: auto;
      margin-right: auto;
      background: #111;
      padding: 20px;
      border-radius: 15px;
    }

    #loginForm input {
      width: 90%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 10px;
      border: none;
      font-size: 16px;
    }

    #loginForm button {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: none;
      background-color: #00ff00;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      color: black;
    }

    #loginMessage {
      margin-top: 10px;
      font-weight: bold;
      height: 20px;
    }

    /* Debug-Badge */
    #debugBadge {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(255, 0, 0, 0.2);
      color: #ff6b6b;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 12px;
      display: none;
    }

    pre#debugBox {
      background: #111;
      color: lime;
      padding: 10px;
      text-align: left;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
      margin: 20px auto;
      width: 80%;
      display: none;
    }
  </style>
</head>
<body>
  <h1>MolchOS</h1>

  <button id="startButton" aria-label="Start">
    <img src="https://img.icons8.com/?size=100&id=85077&format=png&color=FFFFFF" alt="Power Button">
  </button>

  <div id="myProgress">
    <div id="myBar"></div>
  </div>

  <!-- Login -->
  <div id="loginForm">
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Username" autocomplete="username">
    <input type="password" id="password" placeholder="Password" autocomplete="current-password">
    <button id="loginBtn">Login</button>
    <div id="loginMessage"></div>
  </div>

  <div id="debugBadge">DEBUG</div>
  <pre id="debugBox"></pre>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { 
      getAuth, 
      signInWithEmailAndPassword, 
      createUserWithEmailAndPassword 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAJn62nD-a9f9ryy_8Xi0OJhojZ7_6RyOc",
      authDomain: "molchos-8432f.firebaseapp.com",
      projectId: "molchos-8432f",
      storageBucket: "molchos-8432f.appspot.com",
      messagingSenderId: "863467159822",
      appId: "1:863467159822:web:f352836ffa1289f03f575f"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Elemente
    const startButton = document.getElementById("startButton");
    const myProgress = document.getElementById("myProgress");
    const myBar = document.getElementById("myBar");
    const loginForm = document.getElementById("loginForm");
    const loginBtn = document.getElementById("loginBtn");
    const loginMessage = document.getElementById("loginMessage");
    const debugBadge = document.getElementById("debugBadge");
    const debugBox = document.getElementById("debugBox");

    let debugMode = false;

    // Debug-Log
    function logDebug(msg, data = "") {
      if (!debugMode) return;
      const ts = new Date().toLocaleTimeString();
      debugBox.textContent += `[${ts}] ${msg} ${data}\n`;
      debugBox.scrollTop = debugBox.scrollHeight;
    }

    // Ladebalken
    function startProgress() {
      myProgress.style.display = "block";
      let width = 0;
      const interval = setInterval(() => {
        const step = Math.floor(Math.random() * 10) + 1; // random
        width = Math.min(width + step, 100);
        myBar.style.width = width + "%";

        if (width >= 100) {
          clearInterval(interval);
          myProgress.style.display = "none";
          loginForm.style.display = "block";
        }
      }, 500);
    }

    startButton.addEventListener("click", () => {
      startButton.style.display = "none";
      startProgress();
    });

    // Login
    loginBtn.addEventListener("click", async () => {
      let uname = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value;

      if (!uname || !password) {
        loginMessage.textContent = "Bitte alle Felder ausfÃ¼llen.";
        loginMessage.style.color = "red";
        return;
      }

      // Email generieren
      uname = uname.toLowerCase().replace(/[^a-z0-9]/g, "");
      const email = `${uname}@molchos.app`;

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        loginMessage.textContent = "Willkommen, " + uname;
        loginMessage.style.color = "lightgreen";

        if (uname === "admin") {
          window.location.href = "admin.html";
        }
      } catch (error) {
        if (error.code === "auth/user-not-found") {
          try {
            const newUser = await createUserWithEmailAndPassword(auth, email, password);
            loginMessage.textContent = "Neuer Account erstellt: " + uname;
            loginMessage.style.color = "lightgreen";
          } catch (regErr) {
            loginMessage.textContent = "Registrierungsfehler: " + regErr.message;
            loginMessage.style.color = "red";
          }
        } else {
          loginMessage.textContent = "Login fehlgeschlagen: " + error.message;
          loginMessage.style.color = "red";
        }
      }
    });

    // Debug aktivieren mit Taste "d"
    window.addEventListener("keydown", (e) => {
      if (e.key.toLowerCase() === "d") {
        debugMode = !debugMode;
        debugBadge.style.display = debugMode ? "block" : "none";
        debugBox.style.display = debugMode ? "block" : "none";
      }
    });
  </script>
</body>
</html>
